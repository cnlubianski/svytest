% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/permutation.R
\name{perm_test}
\alias{perm_test}
\alias{print.perm_test}
\alias{summary.perm_test}
\alias{tidy.perm_test}
\alias{glance.perm_test}
\title{Permutation test for weight informativeness in survey regression}
\usage{
perm_test(
  model,
  stat = c("pred_mean", "coef_mahal"),
  B = 1000,
  coef_subset = NULL,
  block = NULL,
  normalize = TRUE,
  engine = c("C++", "R"),
  custom_fun = NULL,
  na.action = stats::na.omit
)

\method{print}{perm_test}(x, ...)

\method{summary}{perm_test}(object, ...)

\method{tidy}{perm_test}(x, ...)

\method{glance}{perm_test}(x, ...)
}
\arguments{
\item{model}{An object of class \code{svyglm} (currently supports Gaussian family best).}

\item{stat}{Statistic to use. Options:
  \itemize{
    \item \code{"pred_mean"}:
      Compares the mean predicted outcome under weighted vs. unweighted regression.
      Simple, interpretable, and directly tied to differences in fitted population means.
      Sensitive to shifts in overall prediction levels caused by informative weights.

    \item \code{"coef_mahal"}:
      Computes the Mahalanobis distance between the weighted and unweighted coefficient vectors,
      using the unweighted precision matrix (\eqn{X'X}) as the metric. Captures joint shifts in regression coefficients,
      not just mean predictions. More powerful when informativeness manifests as changes in slopes
      or multiple coefficients simultaneously.
  }}

\item{B}{Number of permutations (e.g., 1000).}

\item{coef_subset}{Optional character vector of coefficient names to include.}

\item{block}{Optional factor for blockwise permutations (e.g., strata), permute within levels.}

\item{normalize}{Logical; if TRUE (default), normalize weights to have mean 1.}

\item{engine}{\code{"C++"} for fast WLS or \code{"R"} for pure R loop.}

\item{custom_fun}{Optional function(model, X, y, wts) -> scalar statistic (overrides \code{stat}).}

\item{na.action}{Function to handle missing data.}

\item{x}{An object of class perm_test}

\item{...}{Additional arguments passed to methods}

\item{object}{An object of class perm_test}
}
\value{
An object of class \code{"perm_test"} with fields:
  \item{stat_obs}{Observed statistic with actual weights}
  \item{stat_null}{Baseline statistic under equal weights (for centering)}
  \item{perm_stats}{Vector of permutation statistics}
  \item{p.value}{Permutation p-value (two-sided, centered at baseline)}
  \item{effect}{Observed minus median of permutation stats}
  \item{stat}{Statistic name}
  \item{B}{Number of permutations}
  \item{call}{Matched call}
  \item{method}{Description string}
}
\description{
Non-parametric test that permutes survey weights (optionally within blocks)
to generate the null distribution of a chosen statistic. Supports fast closed-form
WLS (linear case) via C++ and a pure R engine.
}
\examples{
if (requireNamespace("survey", quietly = TRUE)) {
  # Load in survey package (required) and load in example data
  library(survey)
  data("svytestCE", package = "svytest")

  # Create a survey design and fit a weighted regression model
  des <- svydesign(ids = ~1, weights = ~FINLWT21, data = svytestCE)
  fit <- svyglm(TOTEXPCQ ~ ROOMSQ + BATHRMQ + BEDROOMQ + FAM_SIZE + AGE, design = des)

  # Run permutation diagnostic test; reports permutation statistics with p-value
  results <- perm_test(fit, stat = "pred_mean", B = 1000, engine = "R")
  print(results)
}

}
